spring:
  application:
    name: sharding-jdbc-demo
  profiles:
    active: ${SPRING_PROFILES_ACTIVE:dev}

  config:
    import:
      - nacos:signature-authentication.yaml?public=
      - nacos:${spring.application.name}-${spring.profiles.active}.yaml
      # 必须是命名空间id


  cloud:
    nacos:
      config:
        server-addr: ${NACOS_SERVER_ADDR:localhost:8848}
        # 全局namespace
        namespace: ${NACOS_NAMESPACE:e1560bee-1195-4d9a-b007-1d142af729e9}
        file-extension: yaml
        # 全局默认的group
        group: ${NACOS_CONFIG_GROUP:DEFAULT_GROUP}
        enabled: ${NACOS_CONFIG_ENABLED:true}
        refresh-enabled: true
        import-check:
          enabled: true
        timeout: ${NACOS_TIMEOUT:3000}
      discovery:
        enabled: false

#  shardingsphere:
#    datasource:
#      names: order-db1, order-db2, slave1, slave2
#      order-db1:
#        type: com.zaxxer.hikari.HikariDataSource
#        driver-class-name: com.mysql.cj.jdbc.Driver
#        # 核心修改：url → jdbc-url（HikariCP 4.0.3 必需）
#        jdbc-url: jdbc:mysql://localhost:3307/order_db
#        username: root
#        password: 123456
#        # Hikari 连接池参数（可选，兜底）
#        hikari:
#          maximum-pool-size: 10
#          minimum-idle: 2
#          connection-timeout: 30000
#      order-db2:
#        type: com.zaxxer.hikari.HikariDataSource
#        driver-class-name: com.mysql.cj.jdbc.Driver
#        # 核心修改：url → jdbc-url（HikariCP 4.0.3 必需）
#        jdbc-url: jdbc:mysql://localhost:3307/order_db_1
#        username: root
#        password: 123456
#        # Hikari 连接池参数（可选，兜底）
#        hikari:
#          maximum-pool-size: 10
#          minimum-idle: 2
#          connection-timeout: 30000
#      slave1:
#        type: com.zaxxer.hikari.HikariDataSource
#        driver-class-name: com.mysql.cj.jdbc.Driver
#        # 核心修改：url → jdbc-url（HikariCP 4.0.3 必需）
#        jdbc-url: jdbc:mysql://localhost:3308/order_db
#        username: root
#        password: 123456
#        # Hikari 连接池参数（可选，兜底）
#        hikari:
#          maximum-pool-size: 10
#          minimum-idle: 2
#          connection-timeout: 30000
#      slave2:
#        type: com.zaxxer.hikari.HikariDataSource
#        driver-class-name: com.mysql.cj.jdbc.Driver
#        # 核心修改：url → jdbc-url（HikariCP 4.0.3 必需）
#        jdbc-url: jdbc:mysql://localhost:3308/order_db_1
#        username: root
#        password: 123456
#        # Hikari 连接池参数（可选，兜底）
#        hikari:
#          maximum-pool-size: 10
#          minimum-idle: 2
#          connection-timeout: 30000
#
#    sharding:
#      # 读写分离配置 - 必须在 sharding 下配置
#      master-slave-rules:
#        ms1:
#          master-data-source-name: order-db1
#          slave-data-source-names: slave1
#          load-balance-algorithm-type: round_robin
#        ms2:
#          master-data-source-name: order-db2
#          slave-data-source-names: slave2
#          load-balance-algorithm-type: round_robin
#      tables:
#        t_order:
##         分片策略 - actual-data-nodes 必须引用主从数据源组名称（ms1, ms2）
#          actual-data-nodes: ms${1..2}.t_order_${1..2}
#          key-generator:
#            column: order_id
#            type: SNOWFLAKE
##            props:
##              worker.id: 1
#          table-strategy:
#            inline:
#              sharding-column: order_id
#              algorithm-expression: t_order_$->{order_id % 2 + 1}
##        分库策略
#          database-strategy:
#            inline:
#              sharding-column: user_id
#              algorithm-expression: ms$->{user_id % 2 + 1}
#      ### XXX 广播表可以配置多个，逗号分隔
#      broadcast-tables: t_dict #XXX 实现广播，其实与路由最大的区别是insert操作会广播，配置了路由协议的不会广播
#    props:
#      sql-show: true

  servlet:
    multipart:
      max-request-size: 50MB    # 整个请求体的最大大小
      max-file-size: 50MB       # 单个文件的最大大小
      file-size-threshold: 4KB  # 内存缓存阈值
      enabled: true             # 启用文件上传支持

  redis:
    # Redis集群配置（解决Docker内外网地址冲突问题）
    # 集群节点：使用宿主机IP+映射端口（和Redis公告地址一致）
    # 如果环境变量REDIS_HOST_IP未设置，则使用默认值172.22.225.108
    cluster:
      nodes:
        - "${REDIS_HOST_IP:172.22.225.108}:6379"
        - "${REDIS_HOST_IP:172.22.225.108}:6380"
        - "${REDIS_HOST_IP:172.22.225.108}:6381"
      max-redirects: 3  # 允许最大重定向次数
    timeout: 15000  # 超时时间（毫秒），和Redis配置匹配
    # Lettuce连接池配置
    lettuce:
      pool:
        max-active: 8
        max-idle: 8
        min-idle: 0
      # 关键：关闭拓扑自动刷新（避免客户端重新获取内网IP导致连接失败）
      cluster:
        refresh:
          adaptive: true  # 禁用自适应刷新
          period: 6000 # -1表示关闭自动刷新，不要设为0
  # Redisson 配置（核心）
  redisson:
    # 指定 Redisson 配置文件路径（关键：和 resources/redisson.yml 对应）
    file: classpath:redisson.yml
    # 启用 Redisson（默认true，显式配置更清晰）
    enabled: true
    # 禁用 Spring Data Redis 的自动配置（避免和 Redisson 冲突）
    spring-data-redis:
      enabled: true  # 保持 true，让 Redisson 适配 Spring Data Redis 的 RedisTemplate

#  redis:
#    # Redis服务器地址
#    host: 127.0.0.1
#    # Redis端口
#    port: 6379
#    # 密码（无密码则注释）
##    password: ""
#    # 数据库索引（默认0）
#    database: 0
#    # 连接超时时间
#    timeout: 5000ms
#    # lettuce连接池配置（必须加commons-pool2依赖才生效）
#    lettuce:
#      pool:
#        # 最大活跃连接数
#        max-active: 8
#        # 最大空闲连接数
#        max-idle: 8
#        # 最小空闲连接数
#        min-idle: 2
#        # 最大等待时间（-1表示无限制）
#        max-wait: -1ms

#redisson:
#  # 选择单机模式（clusterServersConfig 是集群模式，要替换成 singleServerConfig）
#  singleServerConfig:
#    address: "redis://127.0.0.1:6379"
#    # 数据库编号，和 spring.redis.database 保持一致
#    database: 0
#    # 如果 Redis 有密码，取消注释并填写，否则删除
#    # password: yourpassword123
#    # 连接超时时间（可选，默认即可）
#    connectTimeout: 10000
#    # 超时重试次数（可选）
#    retryAttempts: 3
#    retryInterval: 1500
#  # 编码方式（推荐使用）
#  codec:
#    type: org.redisson.codec.JsonJacksonCodec

server:
  port: 8080

# 日志配置
logging:
  config: classpath:logback-spring.xml
  level:
    root: INFO
    org.lix.mycatdemo: DEBUG
    org.springframework: INFO
    org.apache.shardingsphere: INFO
  file:
    # Windows 使用项目目录下的 logs 文件夹，Linux 使用 /var/log/app
    # 可通过环境变量 LOG_HOME 覆盖
    path: ${LOG_HOME:${user.dir}/logs}
    name: ${logging.file.path}/application.log

# 日志生产者配置（用于生成测试日志）
log:
  producer:
    enabled: ${LOG_PRODUCER_ENABLED:false}  # 默认关闭，需要时设置为 true

mybatis:
  mapper-locations: classpath:mapper/*.xml
  type-aliases-package: org.lix.mycatdemo.entity
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl

# 关键：禁用 Spring Boot 自带的数据源自动配置（避免冲突）
#spring.autoconfigure.exclude: org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration

namespace:
  dataId: namespace-id.properties
  group: DEFAULT_GROUP
sharding-JDBC:
  dataId: sharding-JDBC.yaml
  group: DEFAULT_GROUP