# 日志路径配置快速参考

## 一、当前架构

- **应用运行环境**：Windows 主机
- **项目路径**：`D:\My Documents\11188813\Projects\mycat-demo`
- **ELK 运行环境**：Docker 容器
- **日志输出位置**：项目根目录下的 `logs/` 文件夹

## 二、配置说明

### 2.1 应用日志路径配置

#### application.yaml

```yaml
logging:
  file:
    path: ${LOG_HOME:${user.dir}/logs}
```

**说明**：
- `${user.dir}`：Java 系统属性，表示当前工作目录（项目根目录）
- Windows 实际路径：`D:\My Documents\11188813\Projects\mycat-demo\logs`
- 可通过环境变量 `LOG_HOME` 覆盖

#### logback-spring.xml

```xml
<springProperty scope="context" name="LOG_HOME" source="logging.file.path" defaultValue="logs"/>
```

**说明**：
- 从 `application.yaml` 的 `logging.file.path` 读取日志路径
- 如果未配置，默认使用 `logs`

### 2.2 Docker Volume 挂载配置

#### docker-compose.yml

```yaml
filebeat:
  volumes:
    - ../logs:/var/log/app:ro
```

**说明**：
- `../logs`：相对于 `docker/` 目录，指向项目根目录的 `logs` 文件夹
- `/var/log/app`：容器内的路径（Filebeat 监控的路径）
- `:ro`：只读挂载

### 2.3 Filebeat 监控配置

#### filebeat.yml

```yaml
filebeat.inputs:
  - type: log
    paths:
      - /var/log/app/*.log
      - /var/log/app/**/*.log
```

**说明**：
- Filebeat 监控容器内的 `/var/log/app/` 目录
- 实际对应主机的 `logs/` 目录

## 三、目录结构

```
mycat-demo/
├── logs/                    # 日志目录（应用输出）
│   ├── application.log
│   ├── application-json.log
│   └── application-error.log
├── docker/
│   ├── docker-compose.yml   # Volume 挂载配置
│   └── filebeat/
│       └── filebeat.yml     # 监控路径配置
└── src/
    └── main/
        └── resources/
            ├── application.yaml    # 日志路径配置
            └── logback-spring.xml  # Logback 配置
```

## 四、验证步骤

### 4.1 检查日志文件生成

1. 启动应用
2. 检查 `logs/` 目录是否生成日志文件：
   ```
   D:\My Documents\11188813\Projects\mycat-demo\logs\
     ├── application.log
     ├── application-json.log
     └── application-error.log
   ```

### 4.2 检查 Docker Volume 挂载

```bash
# 进入 Filebeat 容器
docker exec -it filebeat sh

# 查看挂载的目录
ls -la /var/log/app/

# 应该能看到日志文件
```

### 4.3 检查 Filebeat 日志采集

```bash
# 查看 Filebeat 日志
docker logs filebeat

# 应该看到类似信息：
# "Successfully started input of type: log"
```

## 五、常见问题

### 5.1 日志文件未生成

**原因**：日志目录不存在或权限不足

**解决**：
```bash
# 手动创建 logs 目录
mkdir logs
```

### 5.2 Filebeat 无法读取日志

**原因**：Volume 挂载路径不正确

**解决**：
1. 检查 `docker-compose.yml` 中的挂载路径
2. 确保路径是相对于 `docker/` 目录的
3. 重启 Filebeat 容器

### 5.3 日志路径不匹配

**原因**：应用日志路径与 Filebeat 监控路径不一致

**解决**：
1. 确保 `application.yaml` 中的 `logging.file.path` 指向 `logs/`
2. 确保 `docker-compose.yml` 中的 Volume 挂载正确
3. 确保 `filebeat.yml` 中的监控路径为 `/var/log/app/`

## 六、环境变量配置

### 6.1 自定义日志路径

```bash
# Windows PowerShell
$env:LOG_HOME="D:\My Documents\11188813\Projects\mycat-demo\logs"

# Windows CMD
set LOG_HOME=D:\My Documents\11188813\Projects\mycat-demo\logs

# Linux/Mac
export LOG_HOME=/var/log/app
```

### 6.2 启动应用

```bash
# 使用环境变量
mvn spring-boot:run -DLOG_HOME=logs

# 或通过 IDE 配置环境变量
```

---

**最后更新**：2026-01-20

